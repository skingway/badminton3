<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>ç¾½æ˜Ÿç‹ä¸“ä¸šè½¬åœºåŠ©æ‰‹</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ç¾½æ˜Ÿç‹">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3565/3565261.png">

<style>
    :root { --bg: #0d2a1a; --card: #163d29; --accent: #f39c12; --text: #fff; }
    body{background:var(--bg);color:var(--text);font-family:-apple-system,sans-serif;margin:0;padding:calc(env(safe-area-inset-top) + 10px) 15px 40px;line-height:1.5;}
    .container{max-width:600px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;padding:15px;margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,0.3)}
    .step-title{border-left:4px solid var(--accent);padding-left:10px;margin:15px 0;font-size:18px;font-weight:bold}
    select, input[type="text"]{width:100%;padding:12px;box-sizing:border-box;border-radius:6px;border:none;margin-bottom:8px;font-size:16px;background:#1d4d34;color:#fff}
    input[type="number"]{width:55px;height:40px;text-align:center;font-size:20px;border:none;border-radius:4px;font-weight:bold;background:#fff;color:#000}
    .btn{background:var(--accent);color:#fff;padding:14px;border:none;border-radius:8px;font-size:15px;font-weight:bold;width:100%;cursor:pointer;margin-top:5px}
    .tabs{display:flex;gap:10px;margin-bottom:15px;position:sticky;top:env(safe-area-inset-top);z-index:100;background:var(--bg);padding:5px 0}
    .tab-btn{flex:1;padding:12px;border:none;border-radius:8px;background:#1d4d34;color:#ccc}
    .active{background:var(--accent);color:#fff}
    .row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid #2a5a3d}
    .p-name{width:35%;text-align:center;font-size:15px;font-weight:bold}
    .court-tag{background:#2a5a3d;color:var(--accent);padding:2px 8px;border-radius:4px;font-size:11px;font-weight:bold;margin-bottom:5px;display:inline-block}
    table{width:100%;border-collapse:collapse}
    td,th{padding:10px 5px;border-bottom:1px solid #2a5a3d;text-align:center}
    .report-area{background:#1a1a1a;color:#f39c12;font-family:monospace;padding:15px;font-size:13px;white-space:pre-wrap;margin-top:10px;border-radius:8px;display:none;border:1px dashed #f39c12;line-height:1.2}
</style>
</head>
<body>
<div class="container">
    <div id="setupPage">
        <div style="text-align:center; margin-bottom:20px;">
            <h2 style="color:var(--accent); margin-bottom:5px;">ğŸ‘‘ ç¾½æ˜Ÿç‹ä¸“ä¸šè½¬åœº</h2>
            <span style="font-size:12px; color:#888;">å¤šäººæ•°å…¬å¹³å¯¹é˜µç³»ç»Ÿ (æ¯äººå›ºå®š8åœº)</span>
        </div>
        <div class="step-title">1. é€‰æ‹©äººæ•°è§„æ¨¡</div>
        <select id="pCount" onchange="updateInputs()">
            <option value="8">8äººè½¬ (å•/åŒåœºæ··åˆ)</option>
            <option value="10" selected>10äººè½¬ (åŒåœºåœ°/20åœº)</option>
            <option value="11">11äººè½¬ (åŒåœºåœ°/22åœº)</option>
            <option value="12">12äººè½¬ (åŒåœºåœ°/24åœº)</option>
        </select>
        <div class="step-title">2. è¾“å…¥é€‰æ‰‹å§“å</div>
        <div class="card" id="nameInputs"></div>
        <button class="btn" onclick="start()">å¼€å¯æ–°æ¯”èµ›</button>
        <button id="restoreBtn" class="btn" style="display:none; background:none; border:1px solid var(--accent); color:var(--accent); margin-top:15px;" onclick="restore()">å‘ç°æœªå®Œæˆè®°å½•ï¼šç‚¹å‡»æ¢å¤</button>
    </div>

    <div id="mainPage" style="display:none">
        <div class="tabs">
            <button class="tab-btn active" id="mBtn" onclick="showTab('m')">æ¯”èµ›å½•å…¥</button>
            <button class="tab-btn" id="rBtn" onclick="showTab('r')">å®æ—¶æ’å</button>
        </div>
        <div id="matchPage"></div>
        <div id="rankPage" style="display:none">
            <div class="card">
                <table><thead><tr><th>åæ¬¡</th><th>é€‰æ‰‹</th><th>èƒœ-è´Ÿ</th><th>å‡€èƒœ</th></tr></thead><tbody id="rankBody"></tbody></table>
            </div>
            <button class="btn" onclick="generateReport()">ç”Ÿæˆè§†è§‰æˆ˜æŠ¥</button>
            <div id="reportArea" class="report-area"></div>
            <button id="copyBtn" class="btn" style="display:none; background:#2a5a3d" onclick="copyReport()">å¤åˆ¶æˆ˜æŠ¥åˆ°å¾®ä¿¡</button>
            <button id="downloadBtn" class="btn" style="display:none; background:#1d4d34" onclick="downloadReport()">ä¿å­˜æˆ˜æŠ¥åˆ°æ‰‹æœº</button>
            <button class="btn" style="background:#611;margin-top:30px" onclick="if(confirm('ç¡®å®šæ¸…ç©ºå½“å‰æ¯”èµ›æ•°æ®å¹¶å¼€å¯æ–°ä¸€è½®ï¼Ÿ')){localStorage.removeItem('yxw_data');location.reload();}">é‡ç½®æ‰€æœ‰æ•°æ®</button>
        </div>
    </div>
</div>

<script>
let players = [], currentMatrix = [], scores = [], pCount = 10;
const matrices = {
    8: [[0,1,2,3],[4,5,6,7],[0,2,4,6],[1,3,5,7],[0,3,5,6],[1,2,4,7],[0,4,1,5],[2,6,3,7],[0,5,2,7],[1,4,3,6],[0,6,3,4],[1,7,2,5],[0,7,1,6],[2,4,3,5]],
    10: [[0,1,2,3],[4,5,6,7],[8,9,0,1],[2,3,4,5],[6,7,8,9],[0,2,4,6],[1,3,5,7],[0,4,8,2],[1,5,9,3],[6,8,0,3],[7,9,1,2],[4,9,5,6],[7,8,2,5],[0,5,1,6],[3,4,7,9],[2,6,8,1],[0,7,3,9],[1,4,5,8],[2,9,0,6],[3,8,4,7]],
    11: [[0,1,2,3],[4,5,6,7],[8,9,10,0],[1,2,3,4],[5,6,7,8],[9,10,0,1],[2,3,4,5],[6,7,8,9],[10,0,1,2],[3,4,5,6],[7,8,9,10],[0,2,3,5],[4,6,7,9],[8,10,0,1],[2,4,5,7],[6,8,9,0],[10,1,3,4],[2,6,7,10],[1,5,8,9],[0,4,3,6],[7,10,2,8],[1,9,5,4]],
    12: [[0,1,2,3],[4,5,6,7],[8,9,10,11],[0,4,5,9],[1,2,6,10],[3,7,8,11],[0,6,7,8],[1,4,9,11],[2,3,5,10],[0,2,7,11],[1,5,8,9],[3,4,6,10],[0,3,9,10],[1,6,8,11],[2,4,5,7],[0,5,6,11],[1,3,7,10],[2,4,8,9],[0,8,4,10],[1,7,5,11],[2,6,3,9],[0,1,2,3],[4,5,6,7],[8,9,10,11]]
};

function updateInputs() {
    const count = document.getElementById('pCount').value;
    const container = document.getElementById('nameInputs');
    container.innerHTML = '';
    for(let i=0; i<count; i++) container.innerHTML += `<input type="text" id="p${i}" placeholder="é€‰æ‰‹ ${i+1} å§“å">`;
}

function start() {
    pCount = document.getElementById('pCount').value;
    players = [];
    for(let i=0; i<pCount; i++) players.push(document.getElementById('p'+i).value.trim() || `é€‰æ‰‹${i+1}`);
    currentMatrix = matrices[pCount];
    scores = currentMatrix.map(() => [null, null]);
    sync(); go();
}

function go() {
    document.getElementById('setupPage').style.display = 'none';
    document.getElementById('mainPage').style.display = 'block';
    renderMatches();
}

function renderMatches() {
    const cont = document.getElementById('matchPage');
    cont.innerHTML = currentMatrix.map((m, i) => {
        const tag = players.length > 8 ? `ç¬¬ ${Math.floor(i/2)+1} è½® - ${i%2===0?'ä¸€å·åœº':'äºŒå·åœº'}` : `ç¬¬ ${i+1} åœº`;
        return `<div class="card"><div class="court-tag">${tag}</div><div class="row"><div class="p-name">${players[m[0]]}<br>${players[m[1]]}</div><div><input type="number" value="${scores[i][0]!==null?scores[i][0]:''}" oninput="saveScore(${i},0,this.value)"> : <input type="number" value="${scores[i][1]!==null?scores[i][1]:''}" oninput="saveScore(${i},1,this.value)"></div><div class="p-name">${players[m[2]]}<br>${players[m[3]]}</div></div></div>`;
    }).join('');
}

function saveScore(mi, ti, val) { scores[mi][ti] = val === '' ? null : parseInt(val); sync(); }
function sync() { localStorage.setItem('yxw_data', JSON.stringify({p:players, s:scores, c:pCount})); }
function restore() { const d = JSON.parse(localStorage.getItem('yxw_data')); players = d.p; scores = d.s; pCount = d.c; currentMatrix = matrices[pCount]; go(); }

function showTab(t) {
    document.getElementById('matchPage').style.display = t === 'm' ? 'block' : 'none';
    document.getElementById('rankPage').style.display = t === 'r' ? 'block' : 'none';
    document.getElementById('mBtn').className = t === 'm' ? 'tab-btn active' : 'tab-btn';
    document.getElementById('rBtn').className = t === 'r' ? 'tab-btn active' : 'tab-btn';
    if(t === 'r') calculateRank();
}

function calculateRank() {
    let stats = players.map(name => ({ name, w:0, l:0, nt:0 }));
    currentMatrix.forEach((m, i) => {
        let s1 = scores[i][0], s2 = scores[i][1];
        if(s1 !== null && s2 !== null) {
            let d = s1 - s2;
            [m[0], m[1]].forEach(p => { stats[p].nt += d; if(d > 0) stats[p].w++; else if(d < 0) stats[p].l++; });
            [m[2], m[3]].forEach(p => { stats[p].nt -= d; if(d < 0) stats[p].w++; else if(d > 0) stats[p].l++; });
        }
    });
    stats.sort((a,b) => (b.w - a.w) || (b.nt - a.nt));
    document.getElementById('rankBody').innerHTML = stats.map((s, i) => `<tr><td>${i+1}</td><td><b>${s.name}</b></td><td>${s.w}-${s.l}</td><td style="color:${s.nt>=0?'#ff4d4d':'#2ecc71'}">${s.nt>0?'+'+s.nt:s.nt}</td></tr>`).join('');
    return stats;
}

function generateReport() {
    const stats = calculateRank();
    const now = new Date();
    const timeStr = `${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
    
    let r = `ğŸ‘‘ ã€ ç¾½ æ˜Ÿ ç‹ ã€‘ ä¸“ åœº æˆ˜ æŠ¥ ğŸ‘‘\n`;
    r += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    r += `ğŸ“… æ—¶é—´ï¼š${timeStr}\n`;
    r += `ğŸ‘¥ è§„æ¨¡ï¼š${pCount}äººè½¬ (æ¯äºº8åœº)\n`;
    r += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
    
    r += `ğŸ† ã€ è£ èª‰ æ’ å ã€‘\n`;
    stats.forEach((s, i) => {
        let medal = i===0?"ğŸ¥‡":i===1?"ğŸ¥ˆ":i===2?"ğŸ¥‰":"âœ¨";
        const winRate = ((s.w / 8) * 100).toFixed(0);
        r += `${medal} ç¬¬${i+1}åï¼š${s.name.padEnd(6, ' ')}\n`;
        r += `   æˆ˜ç»©ï¼š${s.w}èƒœ ${s.l}è´Ÿ | å‡€èƒœï¼š${s.nt>0?'+'+s.nt:s.nt} | èƒœç‡ï¼š${winRate}%\n`;
    });
    
    r += `\nğŸ¾ ã€ è¯¦ ç»† èµ› æœ ã€‘\n`;
    currentMatrix.forEach((m, i) => {
        const s = scores[i];
        if(s[0] !== null) {
            const status = s[0] > s[1] ? "èƒœ" : (s[0] < s[1] ? "è´Ÿ" : "å¹³");
            r += `â–«ï¸ è½®${Math.ceil((i+1)/2)}: ${players[m[0]]}/${players[m[1]]} [${s[0]}:${s[1]}] ${players[m[2]]}/${players[m[3]]} (${status})\n`;
        }
    });
    
    r += `\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    r += `ğŸ’¡ ç”±ã€Šç¾½æ˜Ÿç‹åŠ©æ‰‹ã€‹è‡ªåŠ¨ç”Ÿæˆ`;

    const area = document.getElementById('reportArea');
    area.innerText = r; area.style.display = 'block';
    document.getElementById('copyBtn').style.display = 'block';
    document.getElementById('downloadBtn').style.display = 'block';
}

function copyReport() {
    const text = document.getElementById('reportArea').innerText;
    const textArea = document.createElement("textarea");
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
        document.execCommand('copy');
        alert('âœ¨ æˆ˜æŠ¥å·²ç”Ÿæˆå¹¶å¤åˆ¶ï¼\nèµ¶ç´§å»å¾®ä¿¡ç¾¤é‡Œå˜šç‘Ÿä¸€ä¸‹å§~');
    } catch (err) {
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é•¿æŒ‰æ–‡å­—å¤åˆ¶');
    }
    document.body.removeChild(textArea);
}

function downloadReport() {
    const blob = new Blob([document.getElementById('reportArea').innerText], {type: 'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `ç¾½æ˜Ÿç‹æˆ˜æŠ¥_${new Date().getTime()}.txt`;
    a.click();
}

window.onload = () => { updateInputs(); if(localStorage.getItem('yxw_data')) document.getElementById('restoreBtn').style.display = 'block'; };
</script>
</body>
</html>
