<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>多人数转场助手</title>
<style>
    :root { --bg: #0d2a1a; --card: #163d29; --accent: #f39c12; --text: #fff; }
    body{background:var(--bg);color:var(--text);font-family:sans-serif;margin:0;padding:20px;line-height:1.5}
    .container{max-width:600px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;padding:20px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,0.3)}
    .step-title{border-left:4px solid var(--accent);padding-left:10px;margin-bottom:20px;font-size:18px;font-weight:bold}
    select, input[type="text"]{width:100%;padding:12px;box-sizing:border-box;border-radius:6px;border:none;margin-bottom:10px;font-size:16px}
    input[type="number"]{width:60px;height:40px;text-align:center;font-size:20px;border:none;border-radius:4px;font-weight:bold}
    .btn{background:var(--accent);color:#fff;padding:15px;border:none;border-radius:8px;font-size:16px;font-weight:bold;width:100%;cursor:pointer}
    .tabs{display:flex;gap:10px;margin-bottom:20px}
    .tab-btn{flex:1;padding:12px;border:none;border-radius:8px;background:#1d4d34;color:#ccc}
    .active{background:var(--accent);color:#fff}
    .row{display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid #2a5a3d}
    .p-name{width:35%;text-align:center;font-size:15px;font-weight:bold}
    .court-tag{background:#2a5a3d;color:var(--accent);padding:2px 8px;border-radius:4px;font-size:11px;font-weight:bold;margin-bottom:8px;display:inline-block}
    table{width:100%;border-collapse:collapse}
    td,th{padding:12px 5px;border-bottom:1px solid #2a5a3d;text-align:center}
</style>
</head>
<body>
<div class="container">
    <div id="setupPage">
        <div class="step-title">第一步：选择人数</div>
        <select id="pCount" onchange="updateInputs()">
            <option value="8">8人转 (单场/双场可选)</option>
            <option value="10" selected>10人转 (双场地)</option>
            <option value="11">11人转 (双场地)</option>
            <option value="12">12人转 (双场地)</option>
        </select>
        <div class="step-title">第二步：输入选手名单</div>
        <div class="card" id="nameInputs"></div>
        <button class="btn" onclick="start()">开始比赛</button>
    </div>

    <div id="mainPage" style="display:none">
        <div class="tabs">
            <button class="tab-btn active" id="mBtn" onclick="showTab('m')">比赛录入</button>
            <button class="tab-btn" id="rBtn" onclick="showTab('r')">实时排名</button>
        </div>
        <div id="matchPage"></div>
        <div id="rankPage" style="display:none">
            <div class="card">
                <table>
                    <thead><tr><th>名次</th><th>选手</th><th>胜-负</th><th>净胜</th></tr></thead>
                    <tbody id="rankBody"></tbody>
                </table>
            </div>
            <button class="btn" style="background:#611;margin-top:20px" onclick="location.reload()">重置并重新开始</button>
        </div>
    </div>
</div>

<script>
let players = [];
let currentMatrix = [];
let scores = [];

const matrices = {
    8: [[0,1,2,3],[4,5,6,7],[0,2,4,6],[1,3,5,7],[0,3,5,6],[1,2,4,7],[0,4,1,5],[2,6,3,7],[0,5,2,7],[1,4,3,6],[0,6,3,4],[1,7,2,5],[0,7,1,6],[2,4,3,5]],
    10: [[0,1,2,3],[4,5,6,7],[8,9,0,1],[2,3,4,5],[6,7,8,9],[0,2,4,6],[1,3,5,7],[0,4,8,2],[1,5,9,3],[6,8,0,3],[7,9,1,2],[4,9,5,6],[7,8,2,5],[0,5,1,6],[3,4,7,9],[2,6,8,1],[0,7,3,9],[1,4,5,8],[2,9,0,6],[3,8,4,7]],
    11: [[0,1,2,3],[4,5,6,7],[8,9,10,0],[1,2,3,4],[5,6,7,8],[9,10,0,1],[2,3,4,5],[6,7,8,9],[10,0,1,2],[3,4,5,6],[7,8,9,10],[0,2,3,5],[4,6,7,9],[8,10,0,1],[2,4,5,7],[6,8,9,0],[10,1,3,4],[2,6,7,10],[1,5,8,9],[0,4,3,6],[7,10,2,8],[1,9,5,4]],
    12: [[0,1,2,3],[4,5,6,7],[8,9,10,11],[0,4,5,9],[1,2,6,10],[3,7,8,11],[0,6,7,8],[1,4,9,11],[2,3,5,10],[0,2,7,11],[1,5,8,9],[3,4,6,10],[0,3,9,10],[1,6,8,11],[2,4,5,7],[0,5,6,11],[1,3,7,10],[2,4,8,9],[0,8,4,10],[1,7,5,11],[2,6,3,9],[0,1,2,3],[4,5,6,7],[8,9,10,11]]
};

function updateInputs() {
    const count = document.getElementById('pCount').value;
    const container = document.getElementById('nameInputs');
    container.innerHTML = '';
    for(let i=0; i<count; i++) {
        container.innerHTML += `<input type="text" id="p${i}" placeholder="选手 ${i+1} 姓名">`;
    }
}
updateInputs();

function start() {
    const count = document.getElementById('pCount').value;
    for(let i=0; i<count; i++) {
        players.push(document.getElementById('p'+i).value.trim() || `选手${i+1}`);
    }
    currentMatrix = matrices[count];
    scores = currentMatrix.map(() => [null, null]);
    document.getElementById('setupPage').style.display = 'none';
    document.getElementById('mainPage').style.display = 'block';
    renderMatches();
}

function renderMatches() {
    const cont = document.getElementById('matchPage');
    cont.innerHTML = currentMatrix.map((m, i) => {
        const isDouble = players.length > 8;
        const tag = isDouble ? `第 ${Math.floor(i/2)+1} 轮 - ${i%2===0?'一号场':'二号场'}` : `第 ${i+1} 场`;
        return `
        <div class="card">
            <div class="court-tag">${tag}</div>
            <div class="row">
                <div class="p-name">${players[m[0]]}<br>${players[m[1]]}</div>
                <div>
                    <input type="number" oninput="saveScore(${i},0,this.value)"> : 
                    <input type="number" oninput="saveScore(${i},1,this.value)">
                </div>
                <div class="p-name">${players[m[2]]}<br>${players[m[3]]}</div>
            </div>
        </div>`;
    }).join('');
}

function saveScore(mi, ti, val) { scores[mi][ti] = val === '' ? null : parseInt(val); }

function showTab(t) {
    document.getElementById('matchPage').style.display = t === 'm' ? 'block' : 'none';
    document.getElementById('rankPage').style.display = t === 'r' ? 'block' : 'none';
    document.getElementById('mBtn').className = t === 'm' ? 'tab-btn active' : 'tab-btn';
    document.getElementById('rBtn').className = t === 'r' ? 'tab-btn active' : 'tab-btn';
    if(t === 'r') calculateRank();
}

function calculateRank() {
    let stats = players.map(name => ({ name, wins:0, losses:0, net:0 }));
    currentMatrix.forEach((m, i) => {
        let s1 = scores[i][0], s2 = scores[i][1];
        if(s1 !== null && s2 !== null) {
            let diff = s1 - s2;
            [m[0], m[1]].forEach(pIdx => { stats[pIdx].net += diff; if(diff > 0) stats[pIdx].wins++; else if(diff < 0) stats[pIdx].losses++; });
            [m[2], m[3]].forEach(pIdx => { stats[pIdx].net -= diff; if(diff < 0) stats[pIdx].wins++; else if(diff > 0) stats[pIdx].losses++; });
        }
    });
    stats.sort((a,b) => (b.wins - a.wins) || (b.net - a.net));
    document.getElementById('rankBody').innerHTML = stats.map((s, i) => `
        <tr><td>${i+1}</td><td><b>${s.name}</b></td><td>${s.wins}-${s.losses}</td>
        <td style="color:${s.net>=0?'#ff4d4d':'#2ecc71'}">${s.net>0?'+'+s.net:s.net}</td></tr>`).join('');
}
</script>
</body>
</html>